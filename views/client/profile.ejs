<head>
   <!-- css -->
   <link rel="stylesheet" href="/css/clients/profile.css" />
</head>

<form
   class="profile-container-fluid"
   action="/users/update/<%= user._id %>"
   method="post"
   enctype="multipart/form-data"
>
   <div class="profile-head">
      <span class="my-profile">My Profile</span>
      <div class="profile-picture-frame">
         <% if(user.avatar){ %>
         <img
            id="preview-img"
            class="profile-picture"
            loading="eager"
            src="<%= user.avatar %>"
            alt="profile picture"
         />
         <% } else { %>
         <img
            id="preview-img"
            class="profile-picture"
            loading="eager"
            src="/images/user.png"
            alt="profile picture"
            style="backdrop-filter: blur(50px)"
         />
         <% } %>

         <div
            class="uploadImage w-100 h-100 position-absolute"
            style="background: linear-gradient(180deg, transparent 70%, black)"
         >
            <label
               class="w-100 h-100 d-flex align-items-center justify-content-center"
               for="file"
               style="cursor: pointer"
            >
               <input
                  type="file"
                  id="file"
                  name="newAvatar"
                  onchange="showPreview(this), showButton()"
                  hidden
               />
               <img
                  src="/images/up-loading.png"
                  class="w-25"
                  alt="upload file"
               />
            </label>
         </div>
      </div>
   </div>

   <script>
      function showPreview(input) {
         const previewImg = document.getElementById('preview-img');
         const file = input.files[0];

         if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
               previewImg.src = e.target.result;
            };
            reader.readAsDataURL(file);
         } else {
            previewImg.src = '/images/up-loading.png'; // Reset to default image
         }
      }
   </script>
   <%- include('../partials/notificationMessage') %>

   <div class="profile-information">
      <div class="field">
         <span class="field-title">Username</span>
         <div class="field-info">
            <input
               type="text"
               class="w-100 border-0"
               name="username"
               id="username"
               value="<%= user.username %>"
               style="outline: none"
               oninput="showButton()"
            />
         </div>
      </div>
      <div class="field">
         <span class="field-title">Email Address</span>
         <div class="field-info">
            <input
               type="text"
               class="w-100 border-0"
               name="email"
               id="email"
               value="<%= user.email %>"
               style="outline: none"
               oninput="showButton()"
            />
         </div>
      </div>
      <div class="field">
         <a href="/account/profile/resetPassword" class="forgot-password"
            >Forgot Password?</a
         >
      </div>
      <button
         type="submit"
         id="saveBtn"
         class="btn btn-primary"
         style="display: none"
      >
         Save Changes
      </button>
   </div>
</form>

<script>
   function showButton() {
      document.getElementById('saveBtn').style.display = 'block';
   }
</script>
